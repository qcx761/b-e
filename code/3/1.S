; =========================================================
; 文件: mbr.S
; 功能: 主引导程序 (MBR)
; =========================================================

; 常量定义
LOADER_BASE_ADDR    equ 0xA000
LOADER_START_SECTOR equ 0x2

; ---------------------------------------------------------
SECTION MBR vstart=0x7C00     ; BIOS 把 MBR 加载到物理地址 0x7C00

; ------------- 初始化段寄存器和栈 -------------------------
    mov ax, cs
    mov ds, ax
    mov es, ax
    mov ss, ax
    mov fs, ax
    mov sp, 0x7C00            ; 栈顶设在装载地址处

; ------------- 设置 GS 指向显存段 -------------------------
    mov ax, 0xB800
    mov gs, ax

; ------------- 清屏操作 -----------------------------------
; 使用 BIOS 中断 int 10h，功能号 06h “上卷窗口”
; 输入参数：
; AH = 06h (上卷窗口)
; AL = 0 （清除全部行）
; BH = 背景/前景颜色属性（此处 07h = 黑底白字）
; (CH,CL) = 窗口左上角 (0,0)
; (DH,DL) = 窗口右下角 (24,79)
; -----------------------------------------------------------
    mov ax, 0600h
    mov bx, 0700h
    mov cx, 0
    mov dx, 184Fh
    int 10h                   ; 调用 BIOS 显示中断清屏

; ------------- 显示字符串 "1 MBR" -------------------------
; 每个字符占两个字节：
;   第一个字节是 ASCII 字符；
;   第二个字节是颜色属性。
; 颜色字节 0xA4 = 1010_0100b
;   → 背景色: 绿色 (A = 1010)
;   → 前景色: 红色 (4)
;   → 带闪烁效果
; -----------------------------------------------------------

    mov byte [gs:0x00],'1'
    mov byte [gs:0x01],0xA4
    mov byte [gs:0x02],' '
    mov byte [gs:0x03],0xA4
    mov byte [gs:0x04],'M'
    mov byte [gs:0x05],0xA4
    mov byte [gs:0x06],'B'
    mov byte [gs:0x07],0xA4
    mov byte [gs:0x08],'R'
    mov byte [gs:0x09],0xA4

; ------------------ 程序悬停 -------------------------------
    jmp $                     ; 死循环，让程序停在此处

; ------------------ 填充与引导标志 -------------------------
; MBR 共 512 字节，末尾必须以 0x55AA 结尾，否则 BIOS 不会识别为可引导扇区
; -----------------------------------------------------------
    times 510-($-$$) db 0     ; 填充到 510 字节
    dw 0xAA55                 ; 引导标志
